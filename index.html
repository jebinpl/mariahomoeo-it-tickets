<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IT Ticketing System</title>

<style>
body{margin:0;font-family:Arial,sans-serif}
.hidden{display:none}
button{cursor:pointer}

/* LOGIN */
#loginPage{
  max-width:320px;
  margin:20px auto;   /* reduced gap */
  padding:20px 25px;
  border:1px solid #ccc;
  text-align:center;
  box-sizing:border-box;
}
#loginPage input{
  width:100%;
  padding:8px;
  margin:6px 0;
  box-sizing:border-box;
}
#loginPage select{
  width:100%;
  padding:8px;
  margin:6px 0;
  box-sizing:border-box;
}
#headerRole{ 
position:absolute; 
right:20px; top:50%; 
transform:translateY(-50%); 
font-size:22px; 
font-weight:bold; 
cursor:default; 
z-index: 1100; 
}


/* Sticky module headings */
.module-heading{
  position: sticky;
  top: 142px;        /* header (80) + nav (~60) */
  background: white;
  z-index: 902;
  padding: 8px 10px;
  border-bottom: 1px solid #ccc;
}
  
  /* ===== STICKY ACTION BAR ===== */
.action-bar{
  position: sticky;
  top: 182px;        /* heading height */
  background: white;
  z-index: 901;
  padding: 8px 10px;
  display: flex;
  gap: 10px;
}

  .action-bar h2 {
  margin: 0;
  font-size: 26px;      /* adjust size as needed */
  line-height: 1.2;
  flex-shrink: 0;       /* prevent heading from shrinking */
}
  /* Table container - scrollable independently */
.table-container{
  max-height: calc(100vh - 240px);
  overflow-y: auto;
}

  /* Sticky table headers */
.table-container thead th{
  position: sticky;
  top: 0;
  background: #eee;
  z-index: 900;
}

/* HEADER */
.top-header{ 
background:#9aa7a7; 
color:white; 
display:flex; 
align-items:center; 
padding:1px 20px; 
position:fixed; 
top: 0; 
left: 0; 
width: 100%; 
height: 80px; z-index: 1000; 
}

.logo-left{height:60px;margin-right:20px}
.header-left h1{font-size:52px;margin:0;letter-spacing:4px}
.header-left p{margin:-3px 0 0;font-size:18px}
.header-center{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
}
.header-center h2{margin:0;font-size:30px}

/* NAV */
.nav-bar{
  background:#20f0e0;
  padding:10px;
  display:flex;
  align-items:center;
  position: fixed;
  top: 82px;
  left: 0;
  width: 100%;
  z-index: 999;
}
.nav-link{margin:0 18px;font-size:18px;cursor:pointer}
.logout{margin-left:auto;margin-right:20px;font-weight:bold;cursor:pointer}

/* CONTENT */
#content{
  padding:20px;
  margin-top: 140px;   /* ðŸ”¥ header (80) + nav (~60) */
}
/* FORM */
form{background:#f9f9f9;padding:15px;margin:10px 0}
input,select{padding:6px;width:100%;margin:4px 0}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}

#loginHeader{
  text-align:center;
  margin-top:40px;
}

.login-logo{
  height:90px;
  margin-bottom:10px;
}

.open-badge {
  background: red;
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  margin-left: 6px;
  display: inline-block;
  min-width: 20px;
  text-align: center;
}  

#loginHeader h1{
  font-size:48px;
  margin:0;
  letter-spacing:4px;
}

#loginHeader p{
  margin:6px 0;
  font-size:18px;
}

#loginHeader h2{
  margin:10px 0 20px;
  font-size:26px;
  font-weight:normal;
}

  /* ===== HEADER ROLE (Emoji + Welcome Text) ===== */
#headerRoleBox{
  position:absolute;
  right:60px;
  top:50%;
  transform:translateY(-50%);
  text-align:center;
  z-index:1100;
  min-width:110px;
}

#headerRoleIcon{
  font-size:26px;
  line-height:1;
}

#headerRoleText{
  font-size:12px;
  margin-top:4px;
  color:white;
  white-space:nowrap;
}

  
</style>
</head>

<body>
  
<!-- LOGIN -->  
<div id="loginHeader">
  <img src="logo.png" alt="Logo" class="login-logo">

  <h1>MARIA</h1>
  <p>Homoeopathic Medical College & Hospital</p>
  <h2>IT - Desk</h2>
</div>


<div id="loginPage">
  <h2>Login</h2>

  <select id="roleSelect">
    <option value="">-- Select Role --</option>
    <option value="user">User</option>
    <option value="admin">Admin</option>
  </select>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <!-- HEADER -->
  <div class="top-header">
    <img src="logo.png" class="logo-left">
    <div class="header-left">
      <h1>MARIA</h1>
      <p>Homoeopathic Medical College & Hospital</p>
    </div>
    <div class="header-center">
      <h2>IT Ticketing System</h2>
    </div>
    <div id="headerRoleBox">
  <div id="headerRoleIcon"></div>
  <div id="headerRoleText"></div>
</div>
  </div>

  <!-- NAV -->
  <div class="nav-bar">
    
      <span class="nav-link" onclick="showIssue()">
    IT-Issue
<span id="openCount" class="open-badge">0</span>
  </span>
    
    <span class="nav-link" onclick="showRequest()">
  IT-Request
  <span id="requestOpenCount" class="open-badge">0</span>
</span>
    
    <span class="nav-link" onclick="showAdmin()">
  IT-Admin
  <span id="adminOpenCount" class="open-badge">0</span>
</span>

    <span class="logout" onclick="logout()">Logout</span>
  </div>

  <!-- CONTENT -->
  <div id="content">
  <p id="welcomeText">Select a module from above.</p>
    
    <!-- IT ISSUE -->
    <div id="issueModule" class="hidden">
      <h2 class="module-heading">IT-Issue</h2>
      
<div class="action-bar">
  <button onclick="openIssueForm()">âž• Create Ticket</button>
  <button onclick="exportExcel()">ðŸ“Š Export Excel</button>
</div>

      <form id="ticketForm" class="hidden">
        <input id="division" placeholder="Division" required>
        <input id="department" placeholder="Department" required>
        <input id="description" placeholder="Issue Description (max 20 characters)" maxlength="20" required>   
<label for="status">Status</label>
<input id="status" placeholder="Enter Status">
        
        <button type="submit">Submit</button>
        <button type="button" onclick="closeIssueForm()">Cancel</button>
      </form>
<div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Ticket ID</th>
            <th>Division</th>
            <th>Department</th>
            <th>Description</th>
            <th>Date Created</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="ticketTable"></tbody>
      </table>
    </div>
  </div>

<!-- IT REQUEST -->
<div id="requestModule" class="hidden">
  <h2 class="module-heading">IT-Request</h2>

<div class="action-bar">
  <button onclick="openRequestForm()">âž• Create Request</button>
  <button onclick="exportRequestExcel()">ðŸ“Š Export Excel</button>
</div>


  <form id="requestForm" class="hidden">
  <input id="requestDivision" placeholder="Division" required>
  <input id="requestDepartment" placeholder="Department" required>

  <input
    id="requestDescription"
    placeholder="Request Description (max 20 characters)"
    maxlength="20"
    required
  >

  <label>Status</label>
  <input id="requestStatus" placeholder="Enter Status">

  <button type="submit">Submit</button>
  <button type="button" onclick="closeForm()">Cancel</button>
</form>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Request ID</th>
        <th>Division</th>
        <th>Department</th>
        <th>Request Description</th>
        <th>Date Created</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="requestTable"></tbody>
  </table>
</div>
</div>

    <!-- IT ADMIN -->
<div id="adminModule" class="hidden">
<h2 class="module-heading">IT-Admin</h2>  
<div class="action-bar">
  <button onclick="openAdminForm()">âž• Create Admin Ticket</button>
  <button onclick="exportAdminExcel()">ðŸ“Š Export Excel</button>
</div>


  <form id="adminForm" class="hidden">
    <input id="adminDivision" placeholder="Division" required>
    <input id="adminDepartment" placeholder="Department" required>
    <input
      id="adminDescription"
      placeholder="Admin Ticket Description (max 20 characters)"
      maxlength="20"
      required
    >
    <label>Status</label>
    <input id="adminStatus" placeholder="Enter Status">

    <button type="submit">Submit</button>
    <button type="button" onclick="closeAdminForm()">Cancel</button>
  </form>
<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Ticket ID</th>
        <th>Division</th>
        <th>Department</th>
        <th>Description</th>
        <th>Date Created</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="adminTable"></tbody>
  </table>
</div>
</div> 
  </div>
</div>

<!-- LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- FIREBASE -->
<script>
  firebase.initializeApp({
    apiKey: "AIzaSyA1ymv16-dU8psCO-pIY0waY-Gkz3Mix9Q",
    authDomain: "mariahomoeo-it.firebaseapp.com",
    projectId: "mariahomoeo-it",
    storageBucket: "mariahomoeo-it.firebasestorage.app",
    messagingSenderId: "926576264951",
    appId: "1:926576264951:web:fa8db2664622fb31ec75f2",
    measurementId: "G-NM1FGJVBZK"
  });
  const db = firebase.firestore();
</script>

<!-- LOGIN + ROLE -->
<script>
window.ROLE = "";
window.onload = () => {
  const savedRole = localStorage.getItem("ROLE");
  if (!savedRole) return;

  ROLE = savedRole;

  loginHeader.classList.add("hidden");
  loginPage.classList.add("hidden");
  dashboard.classList.remove("hidden");

  // ðŸ”¥ NEW: icon + welcome text
  document.getElementById("headerRoleIcon").innerText =
    ROLE === "admin" ? "ðŸ‘¨â€ðŸ’¼" : "ðŸ‘¤";

  document.getElementById("headerRoleText").innerText =
    ROLE === "admin" ? "Welcome Admin" : "Welcome User";

  // keep tooltip

};


function login(){
  const role = roleSelect.value;
  const u = username.value.trim();
  const p = password.value.trim();

  if(!role){
    alert("Please select role");
    return;
  }

  if(role==="user" && u==="user" && p==="user123"){
    ROLE = "user";
localStorage.setItem("ROLE", "user");
  }
  else if(role==="admin" && u==="admin" && p==="admin123"){
    ROLE = "admin";
localStorage.setItem("ROLE", "admin");
  }
  else{
    alert("âŒ Invalid credentials for selected role");
    return;
  }
localStorage.setItem("loggedIn", "true");
localStorage.setItem("ROLE", ROLE);
resetIdleTimer(); // ðŸ”¥ important

  
  loginHeader.classList.add("hidden");   // HIDE login header
  loginPage.classList.add("hidden");
  dashboard.classList.remove("hidden");
document.getElementById("headerRoleIcon").innerText =
  ROLE === "admin" ? "ðŸ‘¨â€ðŸ’¼" : "ðŸ‘¤";

document.getElementById("headerRoleText").innerText =
  ROLE === "admin" ? "Welcome Admin" : "Welcome User";


document.getElementById("headerRole").title =
  ROLE === "admin" ? "Admin" : "User";
  
  // Initial dashboard state: show welcome, hide modules
welcomeText.style.display = "block";
issueModule.classList.add("hidden");
setTimeout(() => {
  rerenderAllModules();
  forceAdminRender(); // ðŸ”¥ important
}, 0);
}

function logout(){
  logoutUser();
}


function hideAllModules(){
  issueModule.classList.add("hidden");
  requestModule.classList.add("hidden");
  adminModule.classList.add("hidden");
}


function rerenderAllModules() {
  if (typeof render === "function") render();               // it-issue
  if (typeof renderRequests === "function") renderRequests(); // it-request
  if (typeof renderAdmins === "function") renderAdmins();     // it-admin
}

  function forceAdminRender() {
  if (typeof renderAdmins === "function") {
    renderAdmins();
  }
}

function showIssue(){
  hideAllModules();
  welcomeText.style.display = "none";
  issueModule.classList.remove("hidden");
}

function showRequest(){
  hideAllModules();
  welcomeText.style.display = "none";
  requestModule.classList.remove("hidden");
}

function showAdmin(){
  hideAllModules();
  welcomeText.style.display = "none";
  adminModule.classList.remove("hidden");
  forceAdminRender(); // ðŸ”¥ immediate admin controls
}
</script>

<!-- IT ISSUE LOGIC -->
<script src="it-issue.js"></script>
<script src="it-request.js"></script>
<script src="it-admin.js"></script>
<script src="session.js"></script>
</body>
</html>








































































